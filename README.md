# rsa_c

## Introduction to RSA

RSA is a public-key cryptosystem, one of the first and most widely used. It's named after its inventors: Rivest, Shamir, and Adleman. RSA is based on the mathematical principle that it is easy to multiply two large prime numbers together but very difficult to factor the resulting large composite number. This one-way function is the basis for generating a pair of keys: a public key that can be shared with anyone to encrypt messages, and a private key that is kept secret and used to decrypt messages encrypted with the corresponding public key.

## Features

* **RSA Key Pair Generation:** Generates a public and private RSA key pair.
* **RSA Encryption:** Encrypts a file using a public key.
* **RSA Decryption:** Decrypts a file using a private key.
* **Custom BigInt Library:** Provides necessary arithmetic operations for large integers.
* **Key Storage:** Saves and loads RSA keys to and from files in a custom format.

## How to Build

The project consists of several C source files and header files. You will need a C compiler (like GCC) and `make`.

1.  Navigate to the project directory in your terminal.
2.  Run the `make` command:

    ```bash
    make
    ```

    This will compile the source files and create an executable named `rsa_run`.

## How to Use

The `rsa_run` executable takes three command-line arguments: the mode (`enc` or `dec`), the input file path, and the output file path.

### Encryption

To encrypt a file, use the `enc` mode. By default, this will generate a new public and private key pair (`public.key` and `private.key`) in the current directory and then encrypt the input file, writing the ciphertext to the output file.

```bash
./rsa_run enc input.txt cipher.txt
```

### Decryption

To decrypt a file, use the `dec` mode. This requires a `private.key` file in the current directory (generated by the encryption step) to perform the decryption.

```bash
./rsa_run dec cipher.txt recovered_input.txt
```

## File Descriptions

* `main.c`: Contains the main function, command-line argument parsing, and the high-level encryption/decryption file handling logic. It uses the `rsa.h` and `BigInt.h` functions.
* `rsa.c`: Implements the RSA algorithm functions, including key pair generation, encryption, and decryption. It relies heavily on the BigInt library for arithmetic operations.
* `rsa.h`: Header file for `rsa.c`, defining the `RSAKey` structure and function prototypes for RSA operations.
* `BigInt.c`: Implements the custom arbitrary-precision integer arithmetic library. It provides functions for creating, manipulating, and performing arithmetic operations (addition, subtraction, multiplication, division with remainder, modular exponentiation, GCD, modular inverse) on large integers represented by the `BigInt` structure.
* `BigInt.h`: Header file for `BigInt.c`, defining the `BigInt` structure and function prototypes for BigInt operations.
* `cipher.txt`: An example file containing ciphertext.
* `modulus.txt`: An example file likely containing the modulus (n) of an RSA key pair in hexadecimal format.
* `input.txt`: An example file containing plaintext before encryption.
* `output.txt`: An example file likely containing recovered plaintext after decryption.
* `private_exponent.txt`: An example file likely containing the private exponent (d) of an RSA key pair in hexadecimal format.
* `README.md`: This file.

## Implementation Details

### BigInt Library

The `BigInt` library handles large integers that exceed the standard integer types in C.
* A `BigInt` is represented by a structure containing a `len` (the number of limbs used) and `limbs` (a pointer to an array of `uint32_t`, representing the digits of the large number in little-endian order).
* Functions are provided for memory management (`bi_new`, `bi_free`, `bi_copy`), conversion from `uint64_t` (`bi_from_u64`), and utility operations like trimming leading zeros (`bi_trim`), getting the bit length (`bi_bitlen`), and comparison (`bi_cmp`).
* Core arithmetic operations (`bi_add`, `bi_sub`, `bi_mul`, `bi_mod`) are implemented to work with the `BigInt` structure.
* More advanced operations crucial for RSA, such as modular exponentiation (`bi_modexp`), greatest common divisor (`bi_gcd`), and modular inverse (`bi_modinv`), are also included.
* Functions for reading and writing BigInts in hexadecimal format to and from files (`bi_read_hex`, `bi_write_hex`) are provided for key storage.

### RSA Implementation

The RSA implementation in `rsa.c` utilizes the `BigInt` library.
* Key pair generation (`rsa_generate_keypair`) uses fixed, relatively small prime numbers `P_VAL` and `Q_VAL` (both 33 bits) and a common public exponent `E_VAL` (65537). It calculates the modulus $n = p \times q$ and the totient $\phi(n) = (p-1) \times (q-1)$. The private exponent $d$ is computed as the modular multiplicative inverse of $e$ modulo $\phi(n)$ using `bi_modinv`.
* Encryption (`rsa_encrypt`) calculates the ciphertext $c$ from the plaintext message $m$ using the public key $(n, e)$ with the formula $c = m^e \pmod{n}$. This is done using the `bi_modexp` function.
* Decryption (`rsa_decrypt`) calculates the plaintext message $m$ from the ciphertext $c$ using the private key $(n, d)$ with the formula $m = c^d \pmod{n}$. This also uses the `bi_modexp` function.
* Key saving and loading (`rsa_save_key`, `rsa_load_key`) are handled by writing and reading the modulus $n$ and the exponent (e or d) in hexadecimal format to and from files, enclosed in simple header and footer lines.
* The `main.c` file handles reading the input file in chunks, converting each chunk to a `BigInt`, encrypting/decrypting it, and writing the resulting `BigInt` (along with its original chunk length) to the output file in hexadecimal format. It also handles the conversion back from `BigInt` to bytes during decryption.

This project provides a basic, functional implementation of the RSA algorithm for educational purposes, demonstrating the core concepts of asymmetric encryption and the necessity of arbitrary-precision arithmetic for such cryptographic systems.
